# 定时发布

## 定时发布功能

PenBridge 支持设定文章的发布时间，系统会在指定时间自动执行发布任务。

### 核心特性

- **精准调度**: 每分钟检查一次待执行任务
- **失败重试**: 发布失败自动重试，最多3次
- **状态探测**: 每日凌晨自动检测平台登录状态
- **邮件通知**: 发布成功/失败/登录过期均有邮件提醒

## 创建定时任务

### 设置步骤

1. 完成文章编辑后，点击发布按钮旁的下拉箭头
2. 选择「定时发布」
3. 设置发布时间（精确到分钟）
4. 选择目标平台（可选多个）
5. 填写各平台的发布设置
6. 点击「创建任务」

### 任务配置

| 配置项 | 说明 |
|--------|------|
| 发布时间 | 精确到分钟的发布时间 |
| 目标平台 | 可选择一个或多个平台 |
| 平台设置 | 各平台的分类、标签等 |

## 任务管理

### 查看任务

在仪表盘页面可以查看：

- 待执行的定时任务列表
- 任务执行时间
- 目标平台
- 任务状态

### 任务操作

- **编辑**: 修改任务设置或发布时间
- **取消**: 取消未执行的任务
- **重试**: 手动重试失败的任务
- **删除**: 删除任务记录

## 任务状态

| 状态 | 说明 | 操作 |
|------|------|------|
| 等待中 | 任务已创建，等待执行时间 | 可编辑/取消 |
| 执行中 | 正在执行发布操作 | 等待完成 |
| 已完成 | 发布成功 | 查看结果 |
| 失败 | 发布失败 | 可重试 |
| 重试中 | 正在自动重试 | 等待完成 |

## 自动重试机制

发布失败时，系统会自动重试：

- **重试次数**: 最多3次
- **重试间隔**: 指数退避（1分钟、2分钟、4分钟）
- **重试条件**: 网络错误、服务端错误等临时性失败
- **停止重试**: 登录失效、内容违规等永久性失败

### 失败原因

常见的失败原因：

| 类型 | 原因 | 是否重试 |
|------|------|----------|
| 临时失败 | 网络超时、服务繁忙 | ✅ |
| 登录失效 | Cookie 过期 | ❌ |
| 内容问题 | 违反平台规范 | ❌ |
| 配置错误 | 分类/标签无效 | ❌ |

## 邮件通知

### 通知类型

配置邮件服务后，以下事件会发送邮件通知：

| 事件 | 说明 |
|------|------|
| 发布成功 | 定时任务执行成功 |
| 发布失败 | 任务失败（含失败原因） |
| 登录过期 | 平台登录状态失效 |
| 重试失败 | 多次重试后仍失败 |

### 配置邮件

1. 进入设置 → 邮件配置
2. 填写 SMTP 服务器信息
3. 设置发件人信息
4. 添加接收通知的邮箱
5. 发送测试邮件验证

支持的邮件服务：
- QQ 邮箱
- 163 邮箱
- Gmail
- 自定义 SMTP 服务器

## 登录状态探测

### 自动探测

系统每日凌晨自动检测各平台登录状态：

- 检测时间: 每日 00:00
- 检测方式: 调用平台 API 验证 Cookie 有效性
- 失效处理: 发送邮件通知，暂停该平台的定时任务

### 手动检测

也可以手动检测登录状态：

1. 进入设置 → 平台账号
2. 点击「检测登录状态」
3. 查看检测结果

## 注意事项

### 应用运行

- **桌面应用**: 需要保持应用在后台运行
- **Docker 部署**: 服务持续运行，无需额外操作
- **Web 版**: 服务端持续运行，无需额外操作

### 时区设置

- 发布时间基于服务器时区
- 桌面应用使用本地系统时区
- Docker 部署需确认容器时区设置

### 最佳实践

1. 发布前确认平台登录状态有效
2. 配置邮件通知及时了解发布结果
3. 定时任务建议设置在工作日工作时间
4. 首次发布建议先手动测试

## 下一步

- [AI 助手](/docs/ai-assistant) - 使用 AI 辅助写作
- [设置](/docs/settings) - 配置应用选项
